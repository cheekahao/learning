(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{363:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"webpack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack"}},[t._v("#")]),t._v(" webpack")]),t._v(" "),s("h2",{attrs:{id:"工作原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工作原理"}},[t._v("#")]),t._v(" 工作原理")]),t._v(" "),s("h3",{attrs:{id:"基本概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[t._v("#")]),t._v(" 基本概念")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Entry")]),t._v(": 入口，执行构建的输入")]),t._v(" "),s("li",[s("code",[t._v("Module")]),t._v(": 模块，在"),s("code",[t._v("Webpack")]),t._v("里一切皆模块，"),s("code",[t._v("Webpack")]),t._v("会从"),s("code",[t._v("Entry")]),t._v("开始，递归找出所有依赖的模块")]),t._v(" "),s("li",[s("code",[t._v("Chunk")]),t._v(": 代码块，一个"),s("code",[t._v("Chunk")]),t._v("由多个模块合成，用于代码合并和分割")]),t._v(" "),s("li",[s("code",[t._v("Loader")]),t._v(": 模块转换器，用于将模块的源内容按照需求转换成新内容")]),t._v(" "),s("li",[s("code",[t._v("Plugin")]),t._v(": 扩展插件，在构建流程中的特定时机会广播对应的事件，插件可以监听这些事件，做出对应的事情")])]),t._v(" "),s("h3",{attrs:{id:"流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#流程"}},[t._v("#")]),t._v(" 流程")]),t._v(" "),s("p",[s("code",[t._v("Webpack")]),t._v("的运行流程是一个串行的过程，从启动开始依次是：")]),t._v(" "),s("ol",[s("li",[t._v("初始化参数：从配置文件和"),s("code",[t._v("Shell")]),t._v("语句中读取与合并参数，得出最终参数")]),t._v(" "),s("li",[t._v("开始编译：基于最终的参数初始化"),s("code",[t._v("Compiler")]),t._v("对象，加载所有配置的插件，通过执行对象的"),s("code",[t._v("run")]),t._v("方法开始编译")]),t._v(" "),s("li",[t._v("确定入口：根据配置中的"),s("code",[t._v("Entry")]),t._v("找出所有入口文件")]),t._v(" "),s("li",[t._v("编译模块：从入口文件出发，调用所有配置的"),s("code",[t._v("Loader")]),t._v("对模块递归的进行编译")]),t._v(" "),s("li",[t._v("完成模块编译：得到每个模块编译后的内容及之间的依赖关系")]),t._v(" "),s("li",[t._v("输出资源：根据入口及模块之前的依赖关系，组装成一个个包含多个模块的"),s("code",[t._v("Chunk")]),t._v("，再将每个"),s("code",[t._v("Chunk")]),t._v("转换成一个单独的文件加入输出列表，这是修改输出内容的最后机会")]),t._v(" "),s("li",[t._v("输出完成：根据配置的输出路径和文件名，将文件内容写入文件系统中")])]),t._v(" "),s("p",[t._v("在以上过程中，"),s("code",[t._v("Webpack")]),t._v("会在特定的时间广播特定的事件，插件在监听到特定事件后可以执行对应的逻辑，并且可以调用"),s("code",[t._v("Webpack")]),t._v("提供的"),s("code",[t._v("API")]),t._v("改变"),s("code",[t._v("Webpack")]),t._v("的运行结果。")]),t._v(" "),s("p",[t._v("整体构建流程可以分为以下三大阶段：")]),t._v(" "),s("ul",[s("li",[t._v("初始化，启动构建，处理配置参数，加载"),s("code",[t._v("Plugin")]),t._v("，实例化"),s("code",[t._v("Compiler")])]),t._v(" "),s("li",[t._v("编译，从"),s("code",[t._v("Entry")]),t._v("开始，针对每个"),s("code",[t._v("Module")]),t._v("串行调用对应"),s("code",[t._v("Loader")]),t._v("去编译内容，并依据"),s("code",[t._v("Module")]),t._v("之间的依赖关系，递归的进行编译处理")]),t._v(" "),s("li",[t._v("输出，将编译后的"),s("code",[t._v("Module")]),t._v("组合成"),s("code",[t._v("Chunk")]),t._v("，然后转换成文件，输出到文件系统")])]),t._v(" "),s("p",[s("code",[t._v("build")]),t._v("时，只执行上述阶段一次。监听模式下，将不断的执行编译，输出阶段")]),t._v(" "),s("h2",{attrs:{id:"模块module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模块module"}},[t._v("#")]),t._v(" 模块Module")]),t._v(" "),s("p",[t._v("在模块化编程中，开发者将程序分解成离散功能块(discrete chunks of functionality)，并称之为模块。")]),t._v(" "),s("p",[t._v("Webpack模块能够以各种方式表达他们的依赖关系，例如：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("ES6``import")]),t._v("语句")]),t._v(" "),s("li",[s("code",[t._v("CommonJS``require()")]),t._v("语句")]),t._v(" "),s("li",[s("code",[t._v("AMD``define")]),t._v("和"),s("code",[t._v("require")]),t._v("语句")]),t._v(" "),s("li",[s("code",[t._v("css/sass/less")]),t._v("文件中的"),s("code",[t._v("@import")]),t._v("语句")]),t._v(" "),s("li",[t._v("样式("),s("code",[t._v("url(...)")]),t._v(")或"),s("code",[t._v("HTML")]),t._v("文件("),s("code",[t._v("<img src=...>")]),t._v(")中的图片链接(image url)")])]),t._v(" "),s("h2",{attrs:{id:"loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loader"}},[t._v("#")]),t._v(" Loader")]),t._v(" "),s("p",[t._v("以处理"),s("code",[t._v("SCSS")]),t._v("文件为例：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        rules"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.scss/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            use"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'style-loader'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    loader"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css-loader'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        minimize"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sass-loader'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("一个"),s("code",[t._v("Loader")]),t._v("的职责是单一的，只负责一种转换。一个源文件需要多次转换，需要配置多个"),s("code",[t._v("Loader")]),t._v("。在调用多个"),s("code",[t._v("Loader")]),t._v("时，执行顺序是"),s("strong",[t._v("从后往前")]),t._v("依次执行")]),t._v(" "),s("h3",{attrs:{id:"基本写法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本写法"}},[t._v("#")]),t._v(" 基本写法")]),t._v(" "),s("p",[s("code",[t._v("Loader")]),t._v("就是一个函数，获取处理前的内容，返回处理后的内容")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 转换逻辑省略")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" source\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"可调用的webpack-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可调用的webpack-api"}},[t._v("#")]),t._v(" 可调用的Webpack API")]),t._v(" "),s("h4",{attrs:{id:"获取loader的options"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取loader的options"}},[t._v("#")]),t._v(" 获取"),s("code",[t._v("Loader")]),t._v("的"),s("code",[t._v("options")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loaderUtils "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'loader-utils'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" loaderUtils"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOptions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 转换逻辑省略")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" source\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"返回其他结果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#返回其他结果"}},[t._v("#")]),t._v(" 返回其他结果")]),t._v(" "),s("p",[t._v("直接"),s("code",[t._v("return")]),t._v("可以返回原内容转换后的内容，返回其他内容需要用到this.callback函数：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当无法转换原内容时，为Webpack返回一个Error")]),t._v("\n    error"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Error "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 原内容转换后的内容")]),t._v("\n    content"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用于通过转换后的内容得出原内容的Source Map，以方便测试")]),t._v("\n    sourceMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" SourceMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果本次转换为原内容生产了AST语法树，则可以将这个AST返回，以方便之后需要AST的Loader复用")]),t._v("\n    abstractSyntaxTree"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AST")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("此外，由于"),s("code",[t._v("Source Map")]),t._v("生产很耗时，通常在开发环境下才生成。因此可以通过"),s("code",[t._v("this.sourceMap")]),t._v("API来配置是否生成"),s("code",[t._v("Source Map")]),t._v("。")]),t._v(" "),s("h4",{attrs:{id:"同步与异步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同步与异步"}},[t._v("#")]),t._v(" 同步与异步")]),t._v(" "),s("p",[t._v("异步转换流程如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" callback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("async")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 转换逻辑省略")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("someAsyncOperation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sourceMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ast")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sourceMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ast"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" source\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"处理二进制数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理二进制数据"}},[t._v("#")]),t._v(" 处理二进制数据")]),t._v(" "),s("p",[t._v("对于二进制数据，需要将"),s("code",[t._v("exports.raw = ture")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" source\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过exports.raw属性告诉Webpack该Loader是否需要二进制数据")]),t._v("\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("raw "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])]),s("h3",{attrs:{id:"缓存加速"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存加速"}},[t._v("#")]),t._v(" 缓存加速")]),t._v(" "),s("p",[t._v("可以通过"),s("code",[t._v("this.cacheable()")]),t._v("方法设置是否缓存计算结果，默认是开启的")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("source")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关闭缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cacheable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" source\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"其他loader-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他loader-api"}},[t._v("#")]),t._v(" 其他Loader API")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("code",[t._v("API")])]),t._v(" "),s("th",[t._v("简介")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("this.context")])]),t._v(" "),s("td",[t._v("当前处理的文件所在目录，以"),s("code",[t._v("/src/main.js")]),t._v("为例，为"),s("code",[t._v("/src")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.resoure")])]),t._v(" "),s("td",[t._v("当前处理的完整请求路径，包括"),s("code",[t._v("query string")]),t._v("，例如"),s("code",[t._v("/src/main.js?name=1")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.resourePath")])]),t._v(" "),s("td",[t._v("当前处理文件的路径，例如"),s("code",[t._v("/src/main.js")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.resoureQuery")])]),t._v(" "),s("td",[t._v("当前处理文件的"),s("code",[t._v("query string")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.target")])]),t._v(" "),s("td",[s("code",[t._v("Webpack")]),t._v("中配置的"),s("code",[t._v("Target")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.loadModule(request: string, callback: function(err, source, sourceMap, ast))")])]),t._v(" "),s("td",[s("code",[t._v("Loader")]),t._v("在处理一个文件时，需要加入依赖时，用于获取对应文件的处理结果")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.addDependency(file: string)")])]),t._v(" "),s("td",[t._v("为当前处理的文件添加依赖。其依赖文件发生变化时，会重新调用loader处理该文件")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.addContextDependency(directory: string)")])]),t._v(" "),s("td",[t._v("将整个目录加入到正在处理的文件依赖中")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.clearDependencies()")])]),t._v(" "),s("td",[t._v("清除当前处理文件的多有依赖")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("this.emitFile(name: string, content: Buffer | string, sourceMap)")])]),t._v(" "),s("td",[t._v("清除当前处理文件的多有依赖")])])])]),t._v(" "),s("h2",{attrs:{id:"plugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plugin"}},[t._v("#")]),t._v(" Plugin")]),t._v(" "),s("h3",{attrs:{id:"compiler和compilation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#compiler和compilation"}},[t._v("#")]),t._v(" Compiler和Compilation")]),t._v(" "),s("p",[t._v("开发"),s("code",[t._v("Plugin")]),t._v("最常用的两个对象就是"),s("code",[t._v("Compiler")]),t._v("和"),s("code",[t._v("Compilation")]),t._v("，他们是"),s("code",[t._v("Plugin")]),t._v("和"),s("code",[t._v("Webpack")]),t._v("之间的桥梁。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Compiler")]),t._v("包含所有配置信息("),s("code",[t._v("options")]),t._v("、"),s("code",[t._v("loaders")]),t._v("和"),s("code",[t._v("plugins")]),t._v("等)，在"),s("code",[t._v("Webpack")]),t._v("启动时被实例化，全局唯一。代表了整个"),s("code",[t._v("Webpack")]),t._v("从启动到关闭的生命周期")]),t._v(" "),s("li",[s("code",[t._v("Compilation")]),t._v("包含当前的模块资源、编译生成资源和变化的文件等。在开发模式下，每当有文件变化时，就有一次新的"),s("code",[t._v("Compilation")]),t._v("被创建。代表了一次编译过程")])]),t._v(" "),s("h3",{attrs:{id:"tapable"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tapable"}},[t._v("#")]),t._v(" Tapable")]),t._v(" "),s("p",[s("code",[t._v("Webpack")]),t._v("通过"),s("code",[t._v("Tapable")]),t._v("来组织构建的事件流。"),s("code",[t._v("Webpack")]),t._v("中许多对象(包括"),s("code",[t._v("Compiler")]),t._v("和"),s("code",[t._v("Compilation")]),t._v(")都继承自"),s("code",[t._v("Tapable")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("Tapable")]),t._v("暴露了"),s("code",[t._v("tap")]),t._v(", "),s("code",[t._v("tapAsync")]),t._v("和"),s("code",[t._v("tapPromise")]),t._v("方法。可以使用这些方法，注入自定义的构建步骤，这些步骤将在整个编译过程中不同时机触发。")]),t._v(" "),s("p",[t._v("都自"),s("code",[t._v("Tapable")]),t._v("，可以广播和监听事件：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * eventName 事件名，不要跟现有事件重名\n * params    附带参数\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compiler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听事件")]),t._v("\ncompiler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("每个插件的"),s("code",[t._v("Compiler")]),t._v("和"),s("code",[t._v("Compilation")]),t._v("对象都是同一个引用。修改"),s("code",[t._v("Compiler")]),t._v("和"),s("code",[t._v("Compilation")]),t._v("对象上的属性就会影响后面的插件。有些事件是异步的，插件处理完成时调用回调函数通知"),s("code",[t._v("Webpack")]),t._v("，才能进入下一个流程。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("compiler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'emit'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("compilation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理逻辑省略")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用callback通知Webpack进入下一个流程")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"基本写法-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本写法-2"}},[t._v("#")]),t._v(" 基本写法")]),t._v(" "),s("p",[s("code",[t._v("Plugin")]),t._v("主要通过监听"),s("code",[t._v("Webpack")]),t._v("在运行的生命周期中广播的特定事件，在合适的时机通过"),s("code",[t._v("Webpack")]),t._v("提供的"),s("code",[t._v("API")]),t._v("做出对应的处理，改变输出结果")]),t._v(" "),s("p",[t._v("一个"),s("code",[t._v("Plugin")]),t._v("就是一个类，具体写法如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在构造函数中可以获取用户对Plugin的配置")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Webpack会调用实例的apply方法，并传入compiler对象")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("compiler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        compiler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'compilation'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("compilation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TestPlugin\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置代码如下：")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" TestPlugin "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./TestPlugin.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    plugins"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("Webpack")]),t._v("启动后，读取配置过程中会初始化插件实例。在初始化"),s("code",[t._v("compiler")]),t._v("对象之后，在调用插件的"),s("code",[t._v("apply")]),t._v("方法，为实例传入"),s("code",[t._v("compiler")]),t._v("对象。插件实例在获取到"),s("code",[t._v("compiler")]),t._v("对象后，通过\n"),s("code",[t._v("compiler.plugin(event: string, callback: function(compilation))")]),t._v("监听"),s("code",[t._v("Webpack")]),t._v("广播的事件，通过"),s("code",[t._v("compiler")]),t._v("对象去操作"),s("code",[t._v("Webpack")])]),t._v(" "),s("h3",{attrs:{id:"常用api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用api"}},[t._v("#")]),t._v(" 常用API")]),t._v(" "),s("p",[t._v("插件可以用来修改输出文件和增加输出文件，甚至提升"),s("code",[t._v("Webpack")]),t._v("性能")]),t._v(" "),s("h4",{attrs:{id:"读取输出资源、代码块、模块及依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#读取输出资源、代码块、模块及依赖"}},[t._v("#")]),t._v(" 读取输出资源、代码块、模块及依赖")]),t._v(" "),s("p",[s("code",[t._v("emit")]),t._v("事件发生时，代表源文件的转换和组装已经完成，可以读取到最终输出的资源、代码块、模块及其依赖，并修改输出资源的内容")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code")])]),s("h3",{attrs:{id:"热更新原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#热更新原理"}},[t._v("#")]),t._v(" 热更新原理")]),t._v(" "),s("p",[t._v("SSE")])])}),[],!1,null,null,null);a.default=e.exports}}]);