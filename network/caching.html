<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP缓存 | 前端笔记</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="learning notebook of cheeka">
    <link rel="preload" href="/assets/css/0.styles.6140569f.css" as="style"><link rel="preload" href="/assets/js/app.b27af4fa.js" as="script"><link rel="preload" href="/assets/js/2.5fc4f946.js" as="script"><link rel="preload" href="/assets/js/28.52aca943.js" as="script"><link rel="prefetch" href="/assets/js/10.369d905b.js"><link rel="prefetch" href="/assets/js/11.331fc11f.js"><link rel="prefetch" href="/assets/js/12.9443d8c7.js"><link rel="prefetch" href="/assets/js/13.333ecdac.js"><link rel="prefetch" href="/assets/js/14.93abd0db.js"><link rel="prefetch" href="/assets/js/15.0b95aafa.js"><link rel="prefetch" href="/assets/js/16.372500f4.js"><link rel="prefetch" href="/assets/js/17.09ca4bd8.js"><link rel="prefetch" href="/assets/js/18.a6fd3900.js"><link rel="prefetch" href="/assets/js/19.659acaac.js"><link rel="prefetch" href="/assets/js/20.320906d7.js"><link rel="prefetch" href="/assets/js/21.0cf978f1.js"><link rel="prefetch" href="/assets/js/22.f89d5d55.js"><link rel="prefetch" href="/assets/js/23.2b823351.js"><link rel="prefetch" href="/assets/js/24.3d8f712f.js"><link rel="prefetch" href="/assets/js/25.477b02c5.js"><link rel="prefetch" href="/assets/js/26.a7abcbf2.js"><link rel="prefetch" href="/assets/js/27.f7e906c9.js"><link rel="prefetch" href="/assets/js/29.80f459c9.js"><link rel="prefetch" href="/assets/js/3.e4a7d532.js"><link rel="prefetch" href="/assets/js/4.d574c98b.js"><link rel="prefetch" href="/assets/js/5.8abf2eed.js"><link rel="prefetch" href="/assets/js/6.a37e6eeb.js"><link rel="prefetch" href="/assets/js/7.1e9eefa2.js"><link rel="prefetch" href="/assets/js/8.6e595e88.js"><link rel="prefetch" href="/assets/js/9.106390a6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6140569f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/css.html" class="nav-link">
  css
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/es6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/javascript/omission.html" class="nav-link">
  JS拾遗
</a></li><li class="dropdown-item"><!----> <a href="/javascript/ts.html" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/framework/vue3/" class="nav-link">
  Vue3源码解读
</a></li><li class="dropdown-item"><!----> <a href="/framework/react.html" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/network/caching.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  缓存
</a></li></ul></div></div><div class="nav-item"><a href="/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><span class="title">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advance/functional.html" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/advance/patterns.html" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/advance/algorithm.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/advance/leet_code.html" class="nav-link">
  LeetCode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈" class="dropdown-title"><span class="title">全栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fullStack/node.html" class="nav-link">
  Node
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学" class="dropdown-title"><span class="title">计算机科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cs/program.html" class="nav-link">
  程序是怎么跑起来的
</a></li><li class="dropdown-item"><!----> <a href="/cs/compiler.html" class="nav-link">
  编译原理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/cheekahao/learning" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe/css.html" class="nav-link">
  css
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/es6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/javascript/omission.html" class="nav-link">
  JS拾遗
</a></li><li class="dropdown-item"><!----> <a href="/javascript/ts.html" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/framework/vue3/" class="nav-link">
  Vue3源码解读
</a></li><li class="dropdown-item"><!----> <a href="/framework/react.html" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络" class="dropdown-title"><span class="title">网络</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/network/http.html" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/network/caching.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  缓存
</a></li></ul></div></div><div class="nav-item"><a href="/engineering/" class="nav-link">
  工程化
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><span class="title">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advance/functional.html" class="nav-link">
  函数式编程
</a></li><li class="dropdown-item"><!----> <a href="/advance/patterns.html" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/advance/algorithm.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/advance/leet_code.html" class="nav-link">
  LeetCode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="全栈" class="dropdown-title"><span class="title">全栈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fullStack/node.html" class="nav-link">
  Node
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学" class="dropdown-title"><span class="title">计算机科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cs/program.html" class="nav-link">
  程序是怎么跑起来的
</a></li><li class="dropdown-item"><!----> <a href="/cs/compiler.html" class="nav-link">
  编译原理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/cheekahao/learning" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/network/caching.html" aria-current="page" class="active sidebar-link">HTTP缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/caching.html#缓存规则" class="sidebar-link">缓存规则</a></li><li class="sidebar-sub-header"><a href="/network/caching.html#缓存控制" class="sidebar-link">缓存控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/network/caching.html#强制缓存" class="sidebar-link">强制缓存</a></li><li class="sidebar-sub-header"><a href="/network/caching.html#协商缓存" class="sidebar-link">协商缓存</a></li><li class="sidebar-sub-header"><a href="/network/caching.html#cache-control" class="sidebar-link">Cache-Control</a></li><li class="sidebar-sub-header"><a href="/network/caching.html#不同刷新的请求执行过程" class="sidebar-link">不同刷新的请求执行过程</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http缓存"><a href="#http缓存" class="header-anchor">#</a> HTTP缓存</h1> <p><code>Web</code>缓存通过复用以前获取的资源，减少等待时间和网络流量，减少了显示资源表示形式所需的时间，可以显著提高网站和应用程序的性能。通过使用<code>HTTP</code>缓存，可以使网站的响应更加敏捷。</p> <p>但是，缓存也需要合理配置，因为并不是所有资源都是永久不变的。重要的是，对一个资源的缓存应截止到其下一次发生改变（即不能缓存过期的资源）。</p> <p>缓存可分为私有与共享缓存两类：</p> <ul><li><strong>共享缓存</strong>存储的响应能够被多个用户使用，例如网关缓存、<code>CDN</code>、反向代理缓存和负载均衡器等。</li> <li><strong>私有缓存</strong>只能用于单个用户，例如浏览器缓存(<code>Brower Caching</code>)。</li></ul> <p><strong><code>HTTP</code>缓存只应该缓存<code>GET</code>请求，因为其是幂等的。</strong></p> <h2 id="缓存规则"><a href="#缓存规则" class="header-anchor">#</a> 缓存规则</h2> <p>按照缓存规则，缓存可以分为<strong>强制缓存</strong>和<strong>协商缓存</strong>两类：</p> <p><strong>强制缓存</strong>是指当缓存数据库中已有所请求的数据时，直接从缓存数据库中获取数据。只有缓存数据库中没有所请求的数据时，才会从服务端获取数据。</p> <p><strong>协商缓存</strong>又称对比缓存，客户端会先从缓存数据库中获取到一个缓存数据的标识，然后请求服务端验证是否失效（新鲜），如果没有失效服务端会返回<code>304</code>，此时客户端直接从缓存中获取所请求的数据，如果标识失效，服务端会返回更新后的数据。</p> <p>两类缓存机制可以同时存在，强制缓存的优先级高于协商缓存，当执行强制缓存时，如若缓存命中，则直接使用缓存数据库数据，不在进行缓存协商。</p> <h2 id="缓存控制"><a href="#缓存控制" class="header-anchor">#</a> 缓存控制</h2> <p>缓存相关的规则信息包含在<code>header</code>中，具体如下：</p> <h3 id="强制缓存"><a href="#强制缓存" class="header-anchor">#</a> 强制缓存</h3> <p>对于强制缓存，服务器响应的<code>header</code>中可以用以下两种方式表明过期时间：</p> <p><strong><code>Expires</code></strong>：服务端返回的数据到期时间。当再次请求时的请求时间小于返回的此时间，则直接使用缓存数据。<code>Expires</code>属于<code>HTTP 1.0</code>协议，但由于服务端时间和客户端时间可能有误差，会导致缓存命中的误差，现在大多数使用<code>Cache-Control</code>替代。</p> <p><strong><code>Cache-Control</code></strong>：<code>Cache-Control</code>有很多属性，不同的属性代表的意义也不同。<code>max-age=t</code>可用来指定时间，表示t秒之后缓存内容将失效。</p> <p>当在<code>Cache-Control</code>中设置了<code>max-age</code>时，<code>Expires</code>将会被忽略。</p> <h3 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h3> <p>协商缓存需要进行对比判断是否可以使用缓存。</p> <p><strong>Last-Modified</strong></p> <p>浏览器第一次请求数据时，服务器会将最后修改时间以<code>Last-Modified: &lt;date&gt;</code>响应首部的形与数据一起发送给客户端。</p> <p>当需要对缓存进行在验证时，浏览器会将该最后修改时间放到<code>If-Modified-Since</code>请求首部中，发送给服务器。服务器会将此时间与服务器上请求资源的最后修改时间进行对比，如果一致则返回一个<code>304 Not Modified</code>响应。<code>304</code>的响应头也可以同时更新缓存文档的过期时间。否则返回带有新数据的状态为<code>200</code>的响应。</p> <p>另外还有一个<code>If-Unmodified-Since</code>请求首部，意思为，当数据没有被修改时，返回数据。否则返回一个<code>412 Precondition failed</code>的响应。</p> <p>对于<code>Last-Modified</code>而言，如果一个资源被修改的，但是实际内容根本没发生改变，会因为<code>Last-Modified</code>时间匹配不上而返回了整个实体给客户端。因此，<code>Last-Modified</code>又被称为<strong>弱校验</strong>。</p> <p><strong>ETag</strong></p> <p>为了解决<code>Last-Modified</code>问题，<code>HTTP 1.1</code>推出了被称为<strong>实体标签</strong><code>ETag</code>强校验。</p> <p><code>ETag</code>是附加到文档上的任意标签（引用字符串），可能包含了文档的序列号或者版本名，或者是文档内容的校验及其他指纹信息。</p> <p>与<code>Last-Modified</code>类似，服务器响应请求时，通过此字段告诉浏览器当前资源在服务器生成的唯一标识（生成规则由服务器决定）。</p> <p>再次请求服务器时，浏览器会将<code>ETag</code>的值放到<code>If-None-Match</code>请求首部中。服务器会将此值与被请求资源的唯一标识进行对比。相同返回<code>304 Not Modified</code>，不同返回带有新的资源内容的<code>200</code>的响应。</p> <p><code>ETag</code>的缺点就是其值是使用算法得出的，会占用服务端计算的资源。</p> <h3 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> Cache-Control</h3> <p><code>HTTP/1.1</code>定义了<code>Cache-Control</code>请求首部来区分不同的缓存策略，请求首部和响应首部都支持。</p> <ul><li><code>Cache-Control: no-store</code>，禁止缓存。缓存中不会存储任何关于客户端请求和服务端响应的内容</li> <li><code>Cache-Control: no-cache</code>，缓存但重新验证。每次有请求发出时，缓存会将此请求发到服务器，以验证请求中所描述的缓存是否过期，若未过期才使用本地缓存副本。</li> <li><code>Cache-Control: public</code>公共缓存或<code>Cache-Control: private</code>私有缓存。公共缓存可以被任何中间人（比如中间代理、CDN等）缓存。私有缓存表示该响应是专用于某单个用户的，中间人不能缓存此响应，只能应用于浏览器私有缓存中。</li> <li><code>Cache-Control: max-age=&lt;seconds&gt;</code>。表示资源能够被缓存（保持新鲜）的最大时间</li> <li><code>Cache-Control: must-revalidate</code>。在事先没有跟原始服务器再验证的情况下，不能提供这个对象的陈旧副本，但缓存可以提供新鲜副本。如果在进行<code>must-revalidate</code>新鲜度检查时，原始服务器不可用时要返回<code>504 Gateway Timeout</code>错误</li></ul> <h3 id="不同刷新的请求执行过程"><a href="#不同刷新的请求执行过程" class="header-anchor">#</a> 不同刷新的请求执行过程</h3> <ul><li>浏览器地址栏中写入URL，回车浏览器发现缓存中有这个文件了，不用继续请求了，直接去缓存拿。（最快）</li> <li><code>F5</code>，就是告诉浏览器，别偷懒，好歹去服务器看看这个文件是否有过期了。于是浏览器就胆胆襟襟的发送一个请求带上<code>If-Modify-Since</code>。</li> <li><code>Ctrl+F5</code>告诉浏览器，你先把你缓存中的这个文件给我删了，然后再去服务器请求个完整的资源文件下来。于是客户端就完成了强行更新的操作.</li></ul> <blockquote><p>参考资料：</p> <p>https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ</p> <p>https://juejin.cn/post/6844903517702848526#heading-1</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b27af4fa.js" defer></script><script src="/assets/js/2.5fc4f946.js" defer></script><script src="/assets/js/28.52aca943.js" defer></script>
  </body>
</html>
