# HTTP相关

## URI与URL

`Web`服务器资源名被称为**统一资源标识符**（Uniform Resource Identifier, URI）。`URI`就像因特网上的邮件地址一样，在世界范围内唯一标识并定位信息资源。

`URI`有两种形式，`URL`和`URN`。

统一资源定位符（URL）是`URI`的最常见方式，描述了一台特定服务器上某资源的特定位置，可以明确说明如何从一个精确、固定的位置获取资源。

大部分`URL`都遵守的标准格式包含以下三个部分：

* 方案（scheme），表示资源使用的协议类型。如`HTTP`协议`http://`
* 因特网网址，例如：`www.baidu.com`
* 资源路径，例如：`/network/http.html`

统一资源名（URN）是作为特定内容的唯一名称使用，与资源所在地无关。使用这个与位置无关的`URN`，就可以将资源四处搬移，也可以用同一个名字通过多种网路访问协议来访问资源。

例如因特网标准文档RFC 2141可以命名为：`urn:ietf:rfc:2141`

`URN`仍然处于试验阶段。

### URL语法

`URL`提供了一种定位`Internet`上任意资源的手段，但是不同的方案(例如`HTTP`、`FTP`和`SMTP`等)的语法不尽相同。

大部分`URL`方案的`URL`语法建立在以下九个部分的通用格式上：

```
<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>
```

| 组件 |  描述 | 默认值|
|:-----:|------|:-----:|
| 方案`scheme` |  访问服务器时使用的协议，有第一个`:`将其与`URL`其余部分分隔开，大小写无关 | - |
| 用户`user` |  访问时需要的用户名，`@`将用户和密码组件和`URL`其余部分分隔开 | 匿名|
| 密码`password` |  用户名后面需要包含密码，中间由冒号(`:`)分隔 | `<E-mail>`地址|
| 主机`host` |  资源宿主服务器的主机名或`IP`地址 |-|
| 端口`port` | 资源宿主服务器正在监听的端口号，很多方案都有默认端口号（`HTTP`的默认端口号为`80`）  | 每个方案特有 |
| 路径`path` |  服务器上资源的本地名，用`/`将其与前面的`URL`组件分隔开，路径组件语法与服务器和方案有关。可以用`/`将`HTTP``URL`的路径组件划分成一些路径段（path segment），每个路径段都有自己的参数`params`组件 |-|
| 参数`params` | 某些方案（例如`FTP`）可以用这个组件来输入参数，参数为名/值对，可以包含多个参数字段，字段之间以及与路径其余部分之间用分号(`;`)分隔 |-|
| 查询`query` | 某些方案（例如`HTTP`）用以传递参数以激活应用程序（比如数据库、公告板、搜索引擎等）。查询组件，没有通用格式，通常大部分网关希望查询字符串以名值对的形式出现名值对之间用`&`分隔；用`?`将其与`URL`其余部分分隔开  |-|
| 片段`frag` |  一小片或者一部分资源的名字。引用对象时，不会将`frag`传给服务器，只在客户端内部使用，通过`#`将其与`URL`其余部分分隔开 |-|

### 相对URL

`URL`有两种方式，绝对的和相对的。绝对`URL`包含访问资源所需要的全部信息。

相对`URL`是`URL`的一种便捷缩略记法。相对`URL`是不完整的，要获取访问资源所需要的全部信息必须相对于基础（base）`URL`进行解析。

### URL字符集

基于历史原因，`URL`采用`US-ASCII`字符集。为了保证`URL`的完整性，设计了**转义序列**。通过转义序列，可以用`US-ASCII`字符集的有限子集对任意紫府进行编码。

`URL`转义序列的编码机制包含一个百分号（%），后面跟着两个表示字符`ASCII`码的十六进制数。例如空格的`ASCII`码为`32(0x20)`，编码之后就是`%20`。

在`URL`中，还有以下几种字符也会被转义：

* 由于有特殊含义被作为保留字符
* 不在`US-ASCII`可打印字符集中
* 有些字符会与某些因特网网关和协议产生混淆

| 字符 |  保留/受限原因 |
|:-----:|-------------|
| `%` |  编码字符转义标志 |
| `/` |  路径组件中分隔路径段的定界符 |
| `.` |  路径组件中使用 |
| `#` |  分段定界符 |
| `?` |  查询字符串定界符 |
| `;` |  参数定界符 |
| `:` |  方案、用户/口令以及主机/端口组件定界符 |
| `$,+` |  保留 |
| `@&=` |  某些方案上下文有特殊含义 |
| `{}|\^~[]'` |  由于各种`Agent`代理比如网关的不安全处理，使用受限 |
| `<>"` |  不安全，在`URL`范围之外用意义 |
| `0x00-0x1F, 0x7F` | `US-ASCII`不可打印字符，受限  |
| `>0x7F` | 不在`US-ASCII`7比特范围内，受限  |

### `URL`方案

| 方案 |  描述 |
|:-----:|-------------|
| `http` | 超文本传入协议方案，除了没有用户名和密码外，与通用`URL`格式相符，默认端口80。<br> 基本格式：`http://<host>:<port>/<path>?<query>#<frag>` |
| `https` | 与`http`一致。默认端口443 |
| `mailto` | `mailto URL`指向的是`Email`地址，与其他方案有所不同，与标准`URL`也有所不同，其语法记录在`RFC 822`中<br> 基本格式：`mailto:<RFC-822-addr-spec>`|
|`ftp`| 文件传输协议，用来从`FTP`服务器上下载或者上传文件，并获取`FTP`服务器的目录结构内容列表。基本格式：`ftp://<user>:<password>@<host>:<port>/<path>;<params>` |
| `rtsp`, `rtspu` | `RTSP URL`是可以通过实时流传输协议解析的音/视频媒体资源标识符。`rtspu`表示使用`UDP`获取资源。基本格式：`rtsp://<user>:<password>@<host>:<port>/<path>` |
|`file`| 表示一台指定主机(本地磁盘、网络文件系统、或其他一些文件共享系统)上可以直接访问的文件。 基本格式：`file://<host>/<path>`|
|`news`| `RFC 1036`定义，用来访问一些特定的文章或者新闻组。`news URL`包含的信息不足以对资源进行定位，需要解释程序。基本格式：`news:<newsgroup>``news:<new-article-id>` |
|`telnet`| 用于访问交互式业务。表示的是可通过`telnet`协议访问的交互式应用程序（资源）。基本格式：`telnet://<user>:<password>@<host>:<port>/` |

## HTTP事务

一个`HTTP`事务由一条（从客户端发往服务器的）请求命令和一个（从服务器发回客户端的）响应结果组成。这种通信是通过名为`HTTP`报文（HTTP message）的格式化数据块进行的。

## HTTP协议版本

* `HTTP/0.9`，1991发布的原型版本，只支持`GET`方法。响应后就马上关闭连接
* `HTTP/1.0`，第一个得到广泛应用的版本，增加了`HEAD`、`POST`方法，增加了`HTTP Headers`和响应状态码
* `HTTP/1.1`，当前普遍使用的版本。
  * 持久连接（`Keep-Alive`），通道复用
  * 增加了`PUT`、`DELETE`，`OPTIONS`等方法
  * 新增断点续传，身份认证，状态管理，缓存等特性
* `HTTP/2.0`，数据以二进制分帧进行传输，头信息压缩，支持服务端推送
* `HTTPS`，使用`SSL`加密传输的`HTTP`安全版本

## Web的结构组件

* 代理，位于客户端和服务器之间的`HTTP`中间实体
* 缓存，`HTTP`的仓库，使常用页面的副本可以保存在离客户端更近的地方
* 网关，连接其他应用程序的特殊`Web`服务器
* 隧道，对`HTTP`通信报文进行盲转发的特殊代理
* Agent代理，发起自动`HTTP`请求的半智能`Web`客户端